
#!/usr/bin/env bash

set -euo pipefail

# Install dependencies
echo ">> Installing Neovim, Lua 5.1, and Luarocks..."
sudo pacman -S --noconfirm --needed neovim lua51 luarocks

# Define base directory and repositories
BASE_DIR="$HOME/personal"
mkdir -p "$BASE_DIR"

declare -A REPOS=(
  [harpoon]="https://github.com/ThePrimeagen/harpoon.git"
#  [vim-apm]="https://github.com/ThePrimeagen/vim-apm.git"
#  [vim-with-me]="https://github.com/ThePrimeagen/vim-with-me.git"
#  [vim-arcade]="https://github.com/ThePrimeagen/vim-arcade.git"
#  [caleb]="https://github.com/ThePrimeagen/caleb.git"
#  [unnamed_game_1]="git@github.com:ThePrimeagen/unnamed_game_1.git"
#  [plenary]="https://github.com/nvim-lua/plenary.nvim.git"
)

echo ">> Cloning repositories..."
for name in "${!REPOS[@]}"; do
  repo_path="$BASE_DIR/$name"

  if [[ -d "$repo_path" ]]; then
    echo "   - Removing existing $name..."
    rm -rf "$repo_path"
  fi

  echo "   - Cloning $name..."
  git clone "${REPOS[$name]}" "$repo_path"
done

# Checkout harpoon2 branch if available
HARPOON_DIR="$BASE_DIR/harpoon"
if [[ -d "$HARPOON_DIR" ]]; then
  echo ">> Switching harpoon to 'harpoon2' branch..."
  git -C "$HARPOON_DIR" fetch
  git -C "$HARPOON_DIR" checkout harpoon2 || echo "⚠️ Failed to checkout harpoon2 branch"
fi

# Install luacheck via Luarocks
echo ">> Installing luacheck..."
sudo luarocks install luacheck

echo "✅ Setup complete."
